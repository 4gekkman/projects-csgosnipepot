# M7 - This package allow to save images the way you want.
---
## Оглавление

  - [Ссылки](#link1)
  - [Введение](#link2)
  - [Общее описание работы пакета](#link3)
  -
	- [Функционал](#link98)
	- [Схемы взаимодействий с другими пакетами](#link99)
  - [Заметки к релизам](#link100)

---

## Ссылки <a id="link1"></a>
```

  > Адрес репозитория пакета M7 на github
      https://github.com/4gekkman/m7

	
			
```

## Введение <a id="link2"></a>
```

  ● Это M-пакет для сохранения загружаемых изображений в папку "public" проекта.
  ● Основные задачи пакета:
    1) Сохранять изображения в папку "public" проекта нужным образом.
    2) Обрабатывать уже сохранённые в папке "public"

 
```

## Общее описание работы пакета <a id="link3"></a>
```

-------------------------
Оглавление

  # Как отдавать изображения
  # Как сохранять изображения
  # Как вычисляется результирующий набор параметров сохранения изображения
  # Список параметров сохранения изображения
  # Пример структуры файлов и папок при работе с изображениями
  # Использование вне пакета M7

-------------------------

> Как отдавать изображения
  - В конфиге NGINX вручную прописывается путь к папке с изображениями.
  - И NGINX (без захода в php) отдаёт эти изображения.

> Как сохранять изображения
  - Командой "C1_saveimage", которая принимает 3 параметра:

    1) Файл-изображение
    2) Имя группы параметров из конфига
    3) Массив параметров

> Как вычисляется результирующий набор параметров сохранения изображения
  - Если 2 и 3 не указаны, используется набор параметров по умолчанию.
  - Набор параметров по умолчанию настраивается в конфиге M-пакета.
  - Если указана и существует 2, то указанные там параметры подменяют
    соответствующие параметры в наборе по умолчанию, и в итоге используется
    получившийся набор.
  - Если указаны и 3, то указанные там параметры подменяют соотв.параметры
    в результирующем (после применения 2 к набору по умолчанию) наборе.
    И в итоге используется получившийся набор.

> Список параметров сохранения изображения

  • [флаг] Сохранять ли оригинал изображения.
  • [флаг] Сохранять ли не обработанные фильтрами изображения.
  • [массив] В каких размерах сохранить изображения, помимо оригинала
  • [массив] В каких типах сохранить изображения, помимо оригинала
  • [число] В каком качестве сохранять изображения (от 0 до 100).
  • [массив] Имена фильтров, которые следует применить.
  • [строка] Путь относ.public к папке, куда надо сохранить изображение.

> Пример структуры файлов и папок при работе с изображениями

    /public
      /csgo_images
        /avatars
          /1
            original.jpg
            original_filtered.jpg
            500x500.jpg
            500x500_filtered.jpg
            500x500.png
            500x500_filtered.png
            1000x1000.jpg
            1000x1000_filtered.jpg
            1000x1000.png
            1000x1000_filtered.png
          /2
        /things
          /1
          /2

> Использование вне пакета M7
  - Чаще всего сохранять изображение нужно будет вне пакета M7.
  - Например, в пакете M5 - при изменении аватара пользователя.
  - Прямо вызвать команду "C1_saveimage" пакета M7 из пакета M5 нельзя.
  - Ведь тогда будет нарушен принцип слабой связанности между пакетами.
  - Вместо этого, надо возбудить событие с ключём "m7:saveimage".
  - Ну, и передать в этом событии все необходимые параметры.
  - В пакете M7 событие поймает обработчик "H1_saveimage", и вызовет
    команду "C1_saveimage", и вернёт результаты работы этой команды.


```

## Функционал <a id="link98"></a>
```

  # Команды и к.команды общего назначения #
  #---------------------------------------#

    Команда                 К.Команда                   Описание
    ----------------------------------------------------------------------------------------------------------------------
    C1_saveimage            | -                         | Save image from file, use specified parameters while saving


  # Обработчики событий #
  #---------------------#

    Обработчик              Описание
    ----------------------------------------------------------------------------------------------------------------------
    H1_saveimage            | Calls C1_saveimage, pass params to it, returns results


```
## Схемы взаимодействий с другими пакетами <a id="link99"></a>
```

  # Push-взаимодействия (по инициативе других пакетов) #
  #----------------------------------------------------#

    ---------------------------------------------------------------------------------------------
    Пакет     Команда     К.Команда     Обработчик      Событие           Комментарий
    ---------------------------------------------------------------------------------------------
    Любой                                               m7:saveimage
    M7                                  H1_saveimage
    M7                                  C1_saveimage


```
## Заметки к релизам <a id="link100"></a>
```

  1.0.0
    - Первый релиз.

```










