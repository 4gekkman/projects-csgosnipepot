/*//===================================================================================////
////																			                                             ////
////   Функционал Free Coins, предназначен для подключения в основной f.js документа   ////
////																			                                             ////
////===================================================================================////
//// 			        		 	    	   ////
//// 			    Оглавление  			 ////
//// 			         				       ////
////=============================//*/
/**
 *
 * 	s8. Функционал Free Coins игроков
 *
 * 		А. Модель ежедневной награды
 * 		-------------------------
 *    f.s8.get_freecoins      	| sА8.1. Получить бесплатные монеты
 *    f.s8.fc_block             | sА8.2. Заблокировать интерфейс бесплатных монет
 *    f.s8.fc_unblock           | sА8.3. Разблокировать интерфейс бесплатных монет
 *    f.s8.fc_left2unblock      | sА8.4. Обновить время, оставшееся до следующего дня
 *
 *    Б. Модель будь онлайн
 *    ------------------
 *    f.s8.counters_freshdata   | sБ8.1. Обновить данные счётчиков свежими
 *
 *
 *
 */

	//--------------------------------------------------------------------//


//========================//
// 			        		 	    //
// 			 Функционал  			//
// 			         			    //
//====================----//
var ModelFunctionsFc = { constructor: function(self, f) { f.s8 = this;

	//-----------------------------//
	// 			        		 	         //
	// 	s8. Функционал Free Coins  //
	// 			         			         //
	//-----------------------------//

	//----------------------------------//
	// sА8.1. Получить бесплатные монеты //
	//----------------------------------//
	f.s8.get_freecoins = function() {

		// 1] Если пользователь уже получал сегодня награду, завершить
		if(self.m.s8.reword.is_got_reword() == 1) return;

		// 2] Завершить, если (или):
		// - Интерфейс заблокирован.
		// - Это анонимный пользователь.
		if(self.m.s0.ajax_counter() || !layoutmodel.m.s0.is_logged_in()) return;

		// 3] Выполнить ajax-запрос
		ajaxko(self, {
			key: 	    		"D10009:10",
			from: 		    "f.s8.get_freecoins",
			data: 		    {

			},
			ajax_params: {

			},
			prejob:       function(config, data, event){

				// 1] Включить спиннер на кнопке
				self.m.s8.reword.is_spinner_vis(true);

			},
			postjob:      function(data, params){


			},
			ok_0:         function(data, params){

				// n] Выключить спиннер на кнопке
				self.m.s8.reword.is_spinner_vis(false);

			},
			ok_1:         function(data, params){

				// n] Выключить спиннер на кнопке
				self.m.s8.reword.is_spinner_vis(false);

			},
			ok_2:         function(data, params){

				// 1] Если пользователь уже получил награду
				if(data.data.errormsg == "1")
					toastr.error("Сегодня Вы уже получили бесплатные монеты.", "Ошибка");

				// 2] Если запрос от анонимуса
				else if(data.data.errormsg == "2")
					toastr.error("Бесплатные монеты может получить только аутентифицированный пользователь.", "Ошибка");

				// n] Если это обычная ошибка
				else {
					toastr.error(data.data.errormsg, "Ошибка при обработке заказа");
				}

				// n] Выключить спиннер на кнопке
				self.m.s8.reword.is_spinner_vis(false);

			}
		});


	};

	//------------------------------------------------//
	// sА8.2. Заблокировать интерфейс бесплатных монет //
	//------------------------------------------------//
	f.s8.fc_block = function() {

		self.m.s8.reword.is_got_reword(1);

	};

	//-------------------------------------------------//
	// sА8.3. Разблокировать интерфейс бесплатных монет //
	//-------------------------------------------------//
	f.s8.fc_unblock = function() {

		self.m.s8.reword.is_got_reword(0);

	};

	//----------------------------------------------------//
	// sА8.4. Обновить время, оставшееся до следующего дня //
	//----------------------------------------------------//
	f.s8.fc_left2unblock = function(data) {

		self.m.s8.reword.time_until_next_day(data.end);

	};


	//------------------------------------------//
	// sБ8.1. Обновить данные счётчиков свежими //
	//------------------------------------------//
	f.s8.counters_freshdata  = function(data) {

		// 1] Обновить данные конфига
		self.m.s8.beonline.giveaway_period_min(data.config.giveaway_period_min);
		self.m.s8.beonline.offline2drop_online_counter_sec(data.config.offline2drop_online_counter_sec);

		// 2] Обновить счётчик
		self.m.s8.beonline.counter((function(){
			if(data.counters[0])
				return data.counters[0].counter;
			else
				return 0;
		})());

		// 3] Обновить клиентский timestamp последнего обновления на клиенте счётчика онлайна
		self.m.s8.beonline.counter_updated_at(Date.now());

	};


return this; }};




























